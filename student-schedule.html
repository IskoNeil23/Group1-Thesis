<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Student Schedule - City College of Angeles City</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        
        .sidebar {
            height: 100%;
            width: 250px;
            position: fixed;
            z-index: 1;
            top: 0;
            left: 0;
            background-color: darkgreen;
            overflow-x: hidden;
            padding-top: 60px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .sidebar img.navlog {
            width: 80px;
            height: auto;
            display: block;
            margin: 0 auto 20px;
        }
        
        .sidebar h1 {
            color: white;
            text-align: center;
            font-size: 35px;
            padding: 0 15px;
            margin-bottom: 30px;
        }
        
        .sidebar a {
            padding: 10px 15px;
            text-decoration: none;
            color: white;
            display: block;
            transition: 0.3s;
        }
        
        .sidebar a:hover, .sidebar a.active {
            background-color: wheat;
            color: black;
            font-weight: bold;
        }
        
        .topnav {
            height: 70px;
            background-color: darkgreen;
            position: fixed;
            top: 0;
            left: 250px;
            color: white;
            right: 0;
            z-index: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            box-shadow: white;
        }
        
        .nav-left {
            display: flex;
            align-items: center;
        }
        
        .nav-left img {
            height: 50px;
            margin-right: 15px;
        }
        
        .logout-btn {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .logout-btn:hover {
            background-color: #d32f2f;
        }
        
        .main {
            margin-left: 250px;
            padding: 90px 20px 20px;
        }
        
        .schedule-header {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .schedule-header h1 {
            color: darkgreen;
            margin-top: 0;
        }
        
        .schedule-filter {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        
        .filter-group label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .filter-group select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .weekly-schedule {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .weekly-schedule h2 {
            color: darkgreen;
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .schedule-table th {
            background-color: #f2f2f2;
            text-align: left;
            padding: 12px;
            border: 1px solid #ddd;
        }
        
        .schedule-table td {
            padding: 12px;
            border: 1px solid #ddd;
            vertical-align: top;
        }
        
        .schedule-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .class-item {
            background-color: #e8f4f8;
            border-left: 4px solid #2196F3;
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 2px;
        }
        
        .class-item h4 {
            margin: 0 0 5px 0;
            color: #333;
        }
        
        .class-item p {
            margin: 3px 0;
            font-size: 13px;
        }
        
        .class-time {
            font-weight: bold;
            color: #0d47a1;
        }
        
        .class-instructor {
            font-style: italic;
        }
        
        .no-classes {
            color: #777;
            font-style: italic;
            text-align: center;
            padding: 15px;
        }
        
        .print-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-left: auto;
        }
        
        .print-btn:hover {
            background-color: #388E3C;
        }
        
        @media screen and (max-width: 768px) {
            .sidebar {
                width: 0;
                padding-top: 15px;
            }
            
            .main, .topnav {
                margin-left: 0;
                left: 0;
            }
            
            .schedule-filter {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .filter-group {
                width: 100%;
                margin-bottom: 10px;
            }
            
            .schedule-table {
                display: block;
                overflow-x: auto;
            }
        }
        
        @media print {
            .sidebar, .topnav, .print-btn, .schedule-filter select, .logout-btn {
                display: none;
            }
            
            .main {
                margin-left: 0;
                padding-top: 20px;
            }
            
            .schedule-table {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <img class="navlog" src="cca-logo.png" alt="CCA Logo">
        <h1>City College of Angeles</h1>
        <a href="student-dashboard.html">Dashboard</a>
        <a href="student-schedule.html" class="active">Schedule</a>
        <a href="student-Attendance.html">Attendance</a>
        <a href="#">Grades</a>
        <a href="student-approval-sheet.html">Approval Letter</a>
    </div>
    
    <div class="topnav">
        <div class="nav-left">
            <img src="cca-logo.png" alt="CCA Logo">
            <h3>Student Portal - Class Schedule</h3>
        </div>
        <button class="logout-btn" onclick="logout()">Log Out</button>
    </div>
    
    <div class="main">
        <div class="schedule-header">
            <h1>My Class Schedule</h1>
            <p>Student: <span id="studentName">Loading...</span> (<span id="studentNumber">Loading...</span>)</p>
            <p>Program: <span id="studentProgram">Loading...</span></p>
            
            <div class="schedule-filter">
                <div class="filter-group">
                    <label for="schoolYear">School Year:</label>
                    <select id="schoolYear" onchange="filterSchedule()">
                        <option value="2024-2025" selected>2024-2025</option>
                        <option value="2025-2026">2025-2026</option>
                        <option value="2026-2027">2026-2027</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="semester">Semester:</label>
                    <select id="semester" onchange="filterSchedule()">
                        <option value="1st Semester">1st Semester</option>
                        <option value="2nd Semester">2nd Semester</option>
                        <option value="Summer">Summer</option>
                    </select>
                </div>
                
                <button class="print-btn" onclick="window.print()">Print Schedule</button>
            </div>
        </div>
        
        <div class="weekly-schedule">
            <h2>Weekly Schedule</h2>
            <div id="scheduleInfo">
                <p><strong>Year Level:</strong> <span id="yearLevel">Loading...</span></p>
                <p><strong>Section:</strong> <span id="section">Loading...</span></p>
            </div>
            
            <table class="schedule-table">
                <thead>
                    <tr>
                        <th style="width: 20%;">Monday</th>
                        <th style="width: 20%;">Tuesday</th>
                        <th style="width: 20%;">Wednesday</th>
                        <th style="width: 20%;">Thursday</th>
                        <th style="width: 20%;">Friday</th>
                        <th style="width: 20%;">Saturday</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="scheduleRow">
                        <td id="schedule-Monday"><div class="no-classes">No classes</div></td>
                        <td id="schedule-Tuesday"><div class="no-classes">No classes</div></td>
                        <td id="schedule-Wednesday"><div class="no-classes">No classes</div></td>
                        <td id="schedule-Thursday"><div class="no-classes">No classes</div></td>
                        <td id="schedule-Friday"><div class="no-classes">No classes</div></td>
                        <td id="schedule-Saturday"><div class="no-classes">No classes</div></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        // Function to format time in 12-hour format
        function formatTime(timeStr) {
            if (!timeStr) return '';
            const [hours, minutes] = timeStr.split(':');
            const time = new Date();
            time.setHours(parseInt(hours, 10));
            time.setMinutes(parseInt(minutes, 10));
            
            return time.toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit', 
                hour12: true 
            });
        }
        
        // Function to get ordinal suffix for numbers
        function getOrdinal(n) {
            const number = parseInt(n);
            if (isNaN(number)) return n;
            
            const j = number % 10;
            const k = number % 100;
            
            if (j === 1 && k !== 11) {
                return number + "st";
            }
            if (j === 2 && k !== 12) {
                return number + "nd";
            }
            if (j === 3 && k !== 13) {
                return number + "rd";
            }
            return number + "th";
        }
        
        // Function to check login status
        function checkLogin() {
            const loggedInStudent = JSON.parse(sessionStorage.getItem('loggedInStudent'));
            
            if (!loggedInStudent) {
                // Redirect to login page if not logged in
                window.location.href = 'student-login.html';
                return null;
            }
            
            // Try to get additional student information from enrolled students database
            const enrolledStudents = JSON.parse(localStorage.getItem('enrolledStudents')) || [];
            const fullStudentInfo = enrolledStudents.find(student => 
                student.studentNumber === loggedInStudent.studentNumber
            ) || loggedInStudent;
            
            return fullStudentInfo;
        }
        
        // Function to display student info
        function displayStudentInfo(student) {
            document.getElementById('studentName').textContent = `${student.firstName} ${student.lastName}`;
            document.getElementById('studentNumber').textContent = student.studentNumber;
            document.getElementById('studentProgram').textContent = `${student.course} (${student.institute})`;
            document.getElementById('yearLevel').textContent = `${getOrdinal(student.yearLevel)} Year`;
            document.getElementById('section').textContent = student.section;
        }
        
        // Function to filter and display schedule
        function filterSchedule() {
            const student = checkLogin();
            if (!student) return;
            
            // Get filter values
            const selectedSchoolYear = document.getElementById('schoolYear').value;
            const selectedSemester = document.getElementById('semester').value;
            
            // Get all instructor schedules
            const allSchedules = JSON.parse(localStorage.getItem('instructorSchedules')) || [];
            
            // Filter schedules for this student based on institute, course, year level, section, school year, and semester
            const studentSchedules = allSchedules.filter(schedule => 
                schedule.institute === student.institute &&
                schedule.course === student.course &&
                schedule.yearLevel === student.yearLevel &&
                schedule.section === student.section &&
                schedule.schoolYear === selectedSchoolYear &&
                schedule.semester === selectedSemester
            );
            
            // Sort schedules by day and time
            studentSchedules.sort((a, b) => {
                const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                const dayCompare = days.indexOf(a.dayOfWeek) - days.indexOf(b.dayOfWeek);
                
                if (dayCompare !== 0) return dayCompare;
                
                const aStart = new Date(`2000-01-01T${a.startTime}`);
                const bStart = new Date(`2000-01-01T${b.startTime}`);
                return aStart - bStart;
            });
            
            // Clear all schedule cells
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            days.forEach(day => {
                document.getElementById(`schedule-${day}`).innerHTML = '<div class="no-classes">No classes</div>';
            });
            
            // If no schedules found
            if (studentSchedules.length === 0) {
                return;
            }
            
            // Group schedules by day
            const schedulesByDay = {};
            days.forEach(day => {
                schedulesByDay[day] = studentSchedules.filter(schedule => schedule.dayOfWeek === day);
            });
            
            // Display schedules in each day column
            days.forEach(day => {
                const daySchedules = schedulesByDay[day];
                if (daySchedules && daySchedules.length > 0) {
                    const dayCell = document.getElementById(`schedule-${day}`);
                    dayCell.innerHTML = ''; // Clear "No classes" message
                    
                    daySchedules.forEach(schedule => {
                        const classItem = document.createElement('div');
                        classItem.className = 'class-item';
                        
                        classItem.innerHTML = `
                            <h4>${schedule.subjectCode}: ${schedule.subjectTitle}</h4>
                            <p class="class-time">${formatTime(schedule.startTime)} - ${formatTime(schedule.endTime)}</p>
                            <p>${schedule.classType} (${schedule.units} units)</p>
                            <p>Room: ${schedule.roomNumber}</p>
                            <p class="class-instructor">Instructor: ${schedule.instructorName}</p>
                        `;
                        
                        dayCell.appendChild(classItem);
                    });
                }
            });
        }
        
        // Function to handle logout
        function logout() {
            // Clear session storage
            sessionStorage.removeItem('loggedInStudent');
            
            // Redirect to login page
            window.location.href = 'student-login.html';
        }
        
        // Initialize page
        window.onload = function() {
            const student = checkLogin();
            if (student) {
                displayStudentInfo(student);
                
                // Set default semester based on current month
                const currentMonth = new Date().getMonth(); // 0-11 (Jan-Dec)
                const semesterSelect = document.getElementById('semester');
                
                if (currentMonth >= 5 && currentMonth <= 9) {
                    // June to October: 1st semester
                    semesterSelect.value = '1st Semester';
                } else if (currentMonth >= 10 || currentMonth <= 2) {
                    // November to March: 2nd semester
                    semesterSelect.value = '2nd Semester';
                } else {
                    // April to May: Summer
                    semesterSelect.value = 'Summer';
                }
                
                // Load schedule with default filters
                filterSchedule();
            }
        };
    </script>
</body>
</html>